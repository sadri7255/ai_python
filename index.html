<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آزمون جامع پایتون (نسخه نهایی)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        .answer-btn.correct {
            background-color: #22c55e !important; /* green-500 */
            color: white !important;
            border-color: #16a34a !important; /* green-600 */
        }
        .answer-btn.incorrect {
            background-color: #ef4444 !important; /* red-500 */
            color: white !important;
            border-color: #dc2626 !important; /* red-600 */
        }
        #quiz-container {
            transition: height 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-8 relative">

    <!-- Online Users Display -->
    <div id="online-users-container" class="absolute top-4 right-4 bg-white bg-opacity-80 backdrop-blur-sm text-gray-700 text-sm font-semibold py-2 px-4 rounded-full shadow-md flex items-center z-10">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-green-500 animate-pulse" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
        </svg>
        <span>کاربران آنلاین: <span id="online-count">۱</span></span>
    </div>

    <div id="quiz-container" class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-6 md:p-8 m-4">
        <h1 id="main-title" class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2">آزمون جامع پایتون</h1>
        <p id="progress-text" class="text-center text-gray-500 mb-6">سوال ۱ از ۵۵</p>
        
        <div id="question-area">
            <h2 id="question-text" class="text-lg md:text-xl font-bold text-gray-700 mb-6 min-h-[6rem] flex items-center justify-center text-center"></h2>
            <div id="answer-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Answer buttons will be generated by JS -->
            </div>
        </div>

        <div id="result-area" class="hidden text-center">
            <h2 id="result-title" class="text-2xl font-bold text-gray-800 mb-4">آزمون به پایان رسید!</h2>
            <p id="score-text" class="text-xl text-gray-600 mb-6"></p>
            <button id="restart-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                شروع مجدد آزمون
            </button>
        </div>

        <div class="mt-8 flex justify-end">
            <button id="next-btn" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-2 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                سوال بعدی
            </button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, onValue, set, onDisconnect, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // --- Firebase Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : { apiKey: "DEMO", authDomain: "DEMO", projectId: "DEMO", databaseURL: "https://<YOUR-PROJECT-ID>.firebaseio.com" };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-quiz-app-presence';
        
        // --- Initialize Firebase ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- NEW: Robust Real-time Presence System (Using Realtime Database) ---
        const onlineCountEl = document.getElementById('online-count');
        
        async function setupPresence() {
            try {
                // Step 1: Authenticate the user.
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                const user = auth.currentUser;

                if (!user) {
                    console.error("Firebase authentication failed. Presence system cannot be initialized.");
                    return;
                }
                
                // This is a standard path for presence systems in RTDB
                const presenceRef = ref(db, `/artifacts/${appId}/public/presence`);
                const userStatusRef = ref(db, `/artifacts/${appId}/public/presence/${user.uid}`);
                
                // Firebase's built-in tool to detect connection status
                const connectedRef = ref(db, '.info/connected');

                onValue(connectedRef, (snap) => {
                    if (snap.val() === true) {
                        // If we are connected, set our presence.
                        set(userStatusRef, { online: true, last_changed: serverTimestamp() });

                        // And when we are disconnected, remove our presence.
                        // This is handled by the Firebase server, making it very reliable.
                        onDisconnect(userStatusRef).remove();
                    }
                });

                // Listen for changes in the main presence collection to update the count.
                onValue(presenceRef, (snapshot) => {
                    // FIX: Use snapshot.size property for Realtime Database instead of numChildren() method
                    const onlineUsersCount = snapshot.exists() ? snapshot.size : 0;
                    onlineCountEl.innerText = onlineUsersCount > 0 ? onlineUsersCount : '1';
                }, (error) => {
                    console.error("Snapshot listener error:", error);
                    onlineCountEl.innerText = '?';
                });

            } catch (error) {
                console.error("Error setting up presence system:", error);
            }
        }

        setupPresence();


        // --- Quiz Application Logic ---
        const quizData = [
            // Chapter 1: History and Basics
            { question: "انگیزه اصلی خودو فان روسوم برای ساخت پایتون چه بود؟", answers: [{ text: "ساخت سریعترین زبان برنامه نویسی جهان", correct: false }, { text: "طراحی زبانی تخصصی برای هوش مصنوعی", correct: false }, { text: "ایجاد زبانی قوی و در عین حال ساده و خوانا", correct: true }, { text: "ارائه جایگزینی برای زبان برنامه‌نویسی جاوا", correct: false }] },
            { question: "کدام ویژگی اصلی پایتون باعث می‌شود که کد نوشته شده در آن برای انسان خواناتر باشد؟", answers: [{ text: "سیستم نوع‌دهی پویا", correct: false }, { text: "استفاده از تورفتگی (Indentation) برای تعریف بلوک کد", correct: true }, { text: "مفسری بودن زبان", correct: false }, { text: "چندسکویی بودن", correct: false }] },
            { question: "کدام یک از فریمورک های زیر برای توسعه وب سایت های بزرگ با پایتون استفاده می شود؟", answers: [{ text: "Flask", correct: false }, { text: "Django", correct: true }, { text: "Tkinter", correct: false }, { text: "NumPy", correct: false }] },
            { question: "مفسر استاندارد پایتون (CPython) با کدام زبان‌ها نوشته شده است؟", answers: [{ text: "فقط پایتون", correct: false }, { text: "جاوا و پایتون", correct: false }, { text: "C و C++", correct: true }, { text: "Go و Rust", correct: false }] },
            { question: "کدام حوزه کاربردی پایتون به طور گسترده از کتابخانه‌هایی مانند Pandas، NumPy و Matplotlib استفاده می‌کند؟", answers: [{ text: "توسعه بازی‌های ویدیویی", correct: false }, { text: "علم داده و یادگیری ماشین", correct: true }, { text: "توسعه نرم‌افزارهای دسکتاپ", correct: false }, { text: "برنامه‌نویسی سیستمی", correct: false }] },

            // Chapter 2: Environments and Installation
            { question: "کدام یک از IDE های زیر به طور خاص برای مبتدیان و اهداف آموزشی طراحی شده است؟", answers: [{ text: "PyCharm", correct: false }, { text: "VS Code", correct: false }, { text: "IDLE", correct: false }, { text: "Thonny", correct: true }] },
            { question: "هنگام نصب پایتون در ویندوز، فعال کردن کدام گزینه برای دسترسی آسان به پایتون از خط فرمان ضروری است؟", answers: [{ text: "Install launcher for all users", correct: false }, { text: "Customize installation", correct: false }, { text: "Add Python to PATH", correct: true }, { text: "Create shortcuts", correct: false }] },
            { question: "هدف اصلی از ایجاد یک 'محیط مجازی' (Virtual Environment) در پایتون چیست؟", answers: [{ text: "افزایش سرعت اجرای کدهای پایتون", correct: false }, { text: "ایزوله کردن وابستگی‌های یک پروژه خاص از سایر پروژه‌ها", correct: true }, { text: "امکان اجرای کد پایتون بدون نیاز به نصب مفسر", correct: false }, { text: "فشرده‌سازی فایل‌های پروژه", correct: false }] },
            { question: "کدام دستور در خط فرمان برای ایجاد یک محیط مجازی به نام `myenv` استفاده می‌شود؟", answers: [{ text: "`python -m venv myenv`", correct: true }, { text: "`python create venv myenv`", correct: false }, { text: "`pip install venv myenv`", correct: false }, { text: "`virtualenv make myenv`", correct: false }] },
            { question: "تفاوت بین حالت اسکریپت (Script Mode) و حالت تعاملی (Interactive Mode) در پایتون چیست؟", answers: [{ text: "حالت اسکریپت برای تست سریع و حالت تعاملی برای نوشتن برنامه‌های کامل است.", correct: false }, { text: "حالت تعاملی کد را خط به خط اجرا می‌کند، در حالی که حالت اسکریپت یک فایل کامل را اجرا می‌کند.", correct: true }, { text: "حالت اسکریپت سریع‌تر است.", correct: false }, { text: "هیچ تفاوتی وجود ندارد.", correct: false }] },

            // Chapter 3: Basic Syntax and Control Flow
            { question: "کدام عملگر در پایتون برای محاسبه 'توان' استفاده می‌شود؟", answers: [{ text: "^", correct: false }, { text: "**", correct: true }, { text: "pow", correct: false }, { text: "exp", correct: false }] },
            { question: "در یک حلقه `for`, دستور `continue` چه کاری انجام می‌دهد؟", answers: [{ text: "به طور کامل از حلقه خارج می‌شود.", correct: false }, { text: "اجرای تکرار فعلی را متوقف کرده و به ابتدای تکرار بعدی می‌پرد.", correct: true }, { text: "حلقه را برای همیشه متوقف می‌کند.", correct: false }, { text: "یک placeholder است.", correct: false }] },
            { question: "نتیجه اجرای دستور `9 // 2` در پایتون چیست؟", answers: [{ text: "4.5", correct: false }, { text: "4", correct: true }, { text: "1", correct: false }, { text: "5", correct: false }] },
            { question: "کدام یک از نام‌های زیر برای متغیر در پایتون نامعتبر است؟", answers: [{ text: "`_my_var`", correct: false }, { text: "`myVar2`", correct: false }, { text: "`2myVar`", correct: true }, { text: "`my_variable`", correct: false }] },
            { question: "برای تغییر یک متغیر سراسری (global) از داخل یک تابع، باید از کدام کلمه کلیدی استفاده کرد؟", answers: [{ text: "`global`", correct: true }, { text: "`var`", correct: false }, { text: "`nonlocal`", correct: false }, { text: "`public`", correct: false }] },

            // Chapter 4: Structured Data Types
            { question: "تفاوت اصلی بین یک `List` و یک `Tuple` در پایتون چیست؟", answers: [{ text: "لیست‌ها مرتب هستند اما تاپل‌ها مرتب نیستند.", correct: false }, { text: "لیست‌ها قابل تغییر (Mutable) هستند، در حالی که تاپل‌ها غیرقابل تغییر (Immutable) هستند.", correct: true }, { text: "لیست‌ها فقط عناصر عددی را نگه می‌دارند.", correct: false }, { text: "تاپل‌ها با `{}` تعریف می‌شوند.", correct: false }] },
            { question: "برای دسترسی به مقدار یک آیتم در دیکشنری که در صورت عدم وجود کلید، خطا ایجاد نکند، کدام روش مناسب‌تر است؟", answers: [{ text: "استفاده از `dict[key]`", correct: false }, { text: "استفاده از متد `.get(key)`", correct: true }, { text: "استفاده از متد `.values()`", correct: false }, { text: "پیمایش روی آیتم‌ها با حلقه", correct: false }] },
            { question: "برای دریافت لیستی از تمام کلیدهای یک دیکشنری به نام `my_dict` از کدام دستور استفاده می کنید؟", answers: [{ text: "`my_dict.keys()`", correct: true }, { text: "`my_dict.values()`", correct: false }, { text: "`keys(my_dict)`", correct: false }, { text: "`my_dict.items()`", correct: false }] },
            { question: "برای افزودن یک عنصر جدید به انتهای یک لیست به نام `my_list` از کدام متد استفاده می‌شود؟", answers: [{ text: "`.insert()`", correct: false }, { text: "`.add()`", correct: false }, { text: "`.append()`", correct: true }, { text: "`.extend()`", correct: false }] },
            { question: "کدام ویژگی باید برای یک مقدار رعایت شود تا بتواند به عنوان کلید (key) در یک دیکشنری استفاده شود؟", answers: [{ text: "باید یک عدد صحیح باشد.", correct: false }, { text: "باید غیرقابل تغییر (Immutable) باشد.", correct: true }, { text: "باید یک رشته باشد.", correct: false }, { text: "باید قابل تغییر (Mutable) باشد.", correct: false }] },
            
            // Chapter 5: Functions and Modules
            { question: "یک تابع `lambda` در پایتون چه ویژگی‌ای دارد؟", answers: [{ text: "می‌تواند چندین عبارت (statement) داشته باشد.", correct: false }, { text: "همیشه باید یک نام مشخص داشته باشد.", correct: false }, { text: "یک تابع ناشناس و تک‌عبارتی (expression) است.", correct: true }, { text: "برای تعریف کلاس‌های ساده استفاده می‌شود.", correct: false }] },
            { question: "برای وارد کردن تمام توابع و کلاس‌های یک ماژول به فضای نام فعلی، از کدام دستور استفاده می‌شود؟", answers: [{ text: "`import module`", correct: false }, { text: "`from module import *`", correct: true }, { text: "`include module`", correct: false }, { text: "`using module`", correct: false }] },
            { question: "کاربرد اصلی `**kwargs` در تعریف یک تابع چیست؟", answers: [{ text: "برای دریافت تعداد نامشخصی آرگومان موقعیتی", correct: false }, { text: "برای دریافت تعداد نامشخصی آرگومان کلیدواژه‌ای", correct: true }, { text: "برای تعریف آرگومان‌های اجباری", correct: false }, { text: "برای تعیین مقدار بازگشتی", correct: false }] },
            { question: "اگر یک تابع هیچ دستور `return` نداشته باشد، به طور پیش‌فرض چه مقداری را برمی‌گرداند؟", answers: [{ text: "0", correct: false }, { text: "`None`", correct: true }, { text: "`True`", correct: false }, { text: "یک رشته خالی", correct: false }] },
            { question: "یک Docstring در پایتون چیست؟", answers: [{ text: "یک نوع کامنت چندخطی که توسط مفسر نادیده گرفته می‌شود.", correct: false }, { text: "یک رشته که به عنوان اولین دستور در یک ماژول، تابع یا کلاس قرار می‌گیرد و به مستندسازی آن کمک می‌کند.", correct: true }, { text: "متغیری که آدرس حافظه یک تابع را نگه می‌دارد.", correct: false }, { text: "یک کلمه کلیدی برای تعریف توابع بازگشتی.", correct: false }] },

            // Chapter 6: Object-Oriented Programming
            { question: "در یک کلاس پایتون، متد خاص `__init__` چه نقشی دارد؟", answers: [{ text: "برای تخریب یک شیء استفاده می‌شود.", correct: false }, { text: "برای مقداردهی اولیه ویژگی‌های یک شیء هنگام ایجاد آن فراخوانی می‌شود.", correct: true }, { text: "برای بازگرداندن نمایش رشته‌ای یک شیء استفاده می‌شود.", correct: false }, { text: "یک متد معمولی است.", correct: false }] },
            { question: "کدام مفهوم OOP به یک کلاس اجازه می‌دهد تا ویژگی‌های کلاس دیگر را به ارث ببرد؟", answers: [{ text: "کپسوله‌سازی", correct: false }, { text: "وراثت (Inheritance)", correct: true }, { text: "چندریختی", correct: false }, { text: "انتزاع", correct: false }] },
            { question: "مفهوم 'Polymorphism' در OOP به چه معناست؟", answers: [{ text: "پنهان کردن جزئیات پیچیده", correct: false }, { text: "قابلیت یک شیء برای داشتن چندین شکل یا رفتار متفاوت", correct:true }, { text: "بسته‌بندی داده و کد در یک کلاس", correct: false }, { text: "ایجاد یک شیء از روی کلاس", correct: false }] },
            { question: "تفاوت بین یک متغیر کلاس (Class Variable) و یک متغیر نمونه (Instance Variable) چیست؟", answers: [{ text: "متغیر نمونه بین تمام اشیاء یک کلاس مشترک است.", correct: false }, { text: "متغیر کلاس فقط در متد `__init__` قابل تعریف است.", correct: false }, { text: "متغیر کلاس بین تمام اشیاء مشترک است، اما متغیر نمونه مختص هر شیء است.", correct: true }, { text: "هیچ تفاوتی وجود ندارد.", correct: false }] },
            { question: "بازنویسی متد (Method Overriding) در وراثت به چه معناست؟", answers: [{ text: "فراخوانی متد کلاس والد از کلاس فرزند.", correct: false }, { text: "ارائه یک پیاده‌سازی جدید برای متدی که از کلاس والد به ارث رسیده است.", correct: true }, { text: "حذف یک متد از کلاس والد.", correct: false }, { text: "افزودن یک متد جدید به کلاس فرزند.", correct: false }] },

            // Chapter 7: Exception Handling
            { question: "در مدیریت استثناها، بلوک `finally` چه زمانی اجرا می‌شود؟", answers: [{ text: "فقط زمانی که استثنایی رخ ندهد.", correct: false }, { text: "همیشه، صرف نظر از اینکه استثنایی رخ بدهد یا نه.", correct: true }, { text: "فقط زمانی که استثنا رخ دهد.", correct: false }, { text: "فقط اگر استثنا مدیریت نشود.", correct: false }] },
            { question: "برای ایجاد (پرتاب) یک استثنای خاص به صورت دستی از کدام کلمه کلیدی استفاده می‌کنید؟", answers: [{ text: "`try`", correct: false }, { text: "`except`", correct: false }, { text: "`raise`", correct: true }, { text: "`throw`", correct: false }] },
            { question: "در ساختار `try...except...else`، بلوک `else` چه زمانی اجرا می‌شود؟", answers: [{ text: "همیشه بعد از `try`.", correct: false }, { text: "فقط اگر در `try` استثنا رخ دهد.", correct: false }, { text: "فقط اگر در `try` هیچ استثنایی رخ ندهد.", correct: true }, { text: "قبل از `try`.", correct: false }] },
            { question: "دستور `assert` در پایتون چه کاربردی دارد؟", answers: [{ text: "برای مدیریت خطاهای زمان اجرا.", correct: false }, { text: "برای بررسی یک شرط و ایجاد یک `AssertionError` در صورت نادرست بودن آن.", correct: true }, { text: "برای چاپ پیام‌های خطایابی.", correct: false }, { text: "برای تعریف متغیرهای ثابت.", correct: false }] },
            { question: "اگر یک استثنا در کد رخ دهد و توسط هیچ بلوک `try...except` مدیریت نشود، چه اتفاقی می‌افتد؟", answers: [{ text: "برنامه به صورت خودکار خطا را نادیده گرفته و ادامه می‌دهد.", correct: false }, { text: "اجرای برنامه متوقف شده و یک پیغام خطا (traceback) نمایش داده می‌شود.", correct: true }, { text: "آخرین مقدار معتبر به عنوان خروجی برگردانده می‌شود.", correct: false }, { text: "برنامه از کاربر می‌خواهد که خطا را برطرف کند.", correct: false }] },

            // Chapter 8: Standard Library & Tic-Tac-Toe
            { question: "کدام ماژول استاندارد پایتون برای تعامل با سیستم عامل استفاده می‌شود؟", answers: [{ text: "`sys`", correct: false }, { text: "`math`", correct: false }, { text: "`os`", correct: true }, { text: "`datetime`", correct: false }] },
            { question: "در کد بازی دوز ارائه شده، از کدام کتابخانه برای ساخت رابط گرافیکی (GUI) استفاده شده است؟", answers: [{ text: "`Pygame`", correct: false }, { text: "`Tkinter`", correct: true }, { text: "`PyQt`", correct: false }, { text: "`Kivy`", correct: false }] },
            { question: "برای انتخاب یک عنصر تصادفی از یک لیست از کدام تابع در ماژول `random` استفاده می‌کنید؟", answers: [{ text: "`random.randint()`", correct: false }, { text: "`random.random()`", correct: false }, { text: "`random.choice()`", correct: true }, { text: "`random.shuffle()`", correct: false }] },
            { question: "ماژول `shutil` در کتابخانه استاندارد برای چه کاری استفاده می‌شود؟", answers: [{ text: "عملیات ریاضی پیچیده.", correct: false }, { text: "عملیات سطح بالا بر روی فایل‌ها و دایرکتوری‌ها (مانند کپی و انتقال).", correct: true }, { text: "ایجاد رابط کاربری گرافیکی.", correct: false }, { text: "ارسال درخواست‌های HTTP.", correct: false }] },
            { question: "متغیر `sys.argv` در پایتون حاوی چیست؟", answers: [{ text: "نسخه فعلی پایتون.", correct: false }, { text: "لیستی از آرگومان‌های ارسال شده به اسکریپت از طریق خط فرمان.", correct: true }, { text: "مسیرهای جستجوی ماژول‌ها.", correct: false }, { text: "اطلاعات مربوط به سیستم عامل.", correct: false }] },

            // Chapter 9: Image Processing
            { question: "کدام کتابخانه به طور تخصصی برای کاربردهای بینایی کامپیوتر استفاده می‌شود؟", answers: [{ text: "Pillow", correct: false }, { text: "OpenCV", correct: true }, { text: "Matplotlib", correct: false }, { text: "NumPy", correct: false }] },
            { question: "برای تبدیل یک تصویر رنگی به مقیاس خاکستری در OpenCV از کدام تابع استفاده می‌شود؟", answers: [{ text: "`cv2.imread()`", correct: false }, { text: "`cv2.cvtColor()`", correct: true }, { text: "`cv2.resize()`", correct: false }, { text: "`cv2.imshow()`", correct: false }] },
            { question: "هدف اصلی از اعمال فیلتر 'High-Pass' بر روی یک تصویر چیست؟", answers: [{ text: "صاف کردن و حذف نویز", correct: false }, { text: "افزایش روشنایی", correct: false }, { text: "تشخیص و برجسته‌سازی لبه‌ها و جزئیات", correct: true }, { text: "کاهش ابعاد تصویر", correct: false }] },
            { question: "هنگامی که یک تصویر با OpenCV خوانده می‌شود، در چه ساختار داده‌ای ذخیره می‌شود؟", answers: [{ text: "یک لیست پایتون", correct: false }, { text: "یک آرایه NumPy", correct: true }, { text: "یک شیء Pillow", correct: false }, { text: "یک دیکشنری پایتون", correct: false }] },
            { question: "تطبیق الگو (Template Matching) در پردازش تصویر چه کاربردی دارد؟", answers: [{ text: "تغییر رنگ‌های تصویر.", correct: false }, { text: "یافتن مکان یک تصویر کوچک (الگو) در یک تصویر بزرگتر.", correct: true }, { text: "افزایش وضوح تصویر.", correct: false }, { text: "چرخاندن تصویر.", correct: false }] },

            // Chapter 10: Genetic Algorithms
            { question: "وظیفه عملگر 'جهش' (Mutation) در الگوریتم ژنتیک چیست؟", answers: [{ text: "ترکیب ویژگی‌های دو والد", correct: false }, { text: "ارزیابی و امتیازدهی به راه‌حل‌ها", correct: false }, { text: "ایجاد تغییرات کوچک و تصادفی در ژن‌های یک راه‌حل.", correct: true }, { text: "انتخاب بهترین راه‌حل‌ها", correct: false }] },
            { question: "عملگر 'Crossover' (ترکیب) در الگوریتم ژنتیک چه کاری انجام می‌دهد؟", answers: [{ text: "معرفی تنوع تصادفی", correct: false }, { text: "ترکیب مواد ژنتیکی دو والد برای ایجاد فرزندان جدید.", correct: true }, { text: "حذف راه‌حل‌های ضعیف", correct: false }, { text: "محاسبه کیفیت راه‌حل‌ها", correct: false }] },
            { question: "نقش 'تابع برازندگی' (Fitness Function) در الگوریتم ژنتیک چیست؟", answers: [{ text: "ایجاد جمعیت اولیه", correct: false }, { text: "سنجش و اندازه‌گیری کیفیت یک راه‌حل کاندید", correct: true }, { text: "ترکیب دو راه‌حل", correct: false }, { text: "تغییر تصادفی یک راه‌حل", correct: false }] },
            { question: "یک 'کروموزوم' در زمینه الگوریتم ژنتیک نشان‌دهنده چیست؟", answers: [{ text: "یک پارامتر از مسئله", correct: false }, { text: "یک راه‌حل کاندید برای مسئله", correct: true }, { text: "جمعیت کل راه‌حل‌ها", correct: false }, { text: "یک عملگر ژنتیکی", correct: false }] },
            { question: "هدف اصلی عملگر 'انتخاب' (Selection) در الگوریتم ژنتیک چیست؟", answers: [{ text: "ایجاد فرزندان جدید از والدین.", correct: false }, { text: "انتخاب افراد شایسته‌تر (با برازندگی بالاتر) برای تولید مثل.", correct: true }, { text: "تغییر دادن ژن‌های یک فرد.", correct: false }, { text: "ارزیابی جمعیت.", correct: false }] },

            // Chapter 11: Deep Learning
            { question: "تفاوت اصلی بین یادگیری ماشین سنتی و یادگیری عمیق چیست؟", answers: [{ text: "یادگیری عمیق به استخراج ویژگی دستی نیاز دارد.", correct: false }, { text: "یادگیری عمیق به طور خودکار ویژگی‌ها را از داده‌های خام یاد می‌گیرد.", correct: true }, { text: "یادگیری ماشین سنتی همیشه دقیق‌تر است.", correct: false }, { text: "یادگیری عمیق فقط برای دسته‌بندی استفاده می‌شود.", correct: false }] },
            { question: "کدام نوع شبکه عصبی برای پردازش داده‌های متوالی که ترتیب در آنها اهمیت دارد، طراحی شده است؟", answers: [{ text: "شبکه عصبی پیچشی (CNN)", correct: false }, { text: "شبکه عصبی بازگشتی (RNN)", correct: true }, { text: "پرسپترون چند لایه (MLP)", correct: false }, { text: "شبکه عصبی ماژولار", correct: false }] },
            { question: "شبکه‌های عصبی پیچشی (CNNs) به طور خاص برای چه نوع مسائلی بسیار موفق عمل می‌کنند؟", answers: [{ text: "تحلیل سری‌های زمانی", correct: false }, { text: "پردازش و تشخیص الگو در تصاویر", correct: true }, { text: "ترجمه ماشینی", correct: false }, { text: "حل مسائل بهینه‌سازی", correct: false }] },
            { question: "نقش 'تابع فعال‌سازی' (Activation Function) در یک نورون مصنوعی چیست؟", answers: [{ text: "ذخیره کردن ورودی‌ها.", correct: false }, { text: "معرفی غیرخطی بودن به شبکه برای یادگیری الگوهای پیچیده.", correct: true }, { text: "جمع کردن ورودی‌های وزن‌دار.", correct: false }, { text: "به‌روزرسانی وزن‌ها.", correct: false }] },
            { question: "کدام نوع یادگیری در شبکه‌های عصبی از داده‌های برچسب‌دار (جفت‌های ورودی-خروجی) برای آموزش مدل استفاده می‌کند؟", answers: [{ text: "یادگیری بدون ناظر (Unsupervised)", correct: false }, { text: "یادگیری تقویتی (Reinforcement)", correct: false }, { text: "یادگیری نظارت‌شده (Supervised)", correct: true }, { text: "یادگیری نیمه-نظارت‌شده (Semi-Supervised)", correct: false }] }
        ];

        // --- DOM Elements ---
        const questionTextEl = document.getElementById('question-text');
        const answerButtonsEl = document.getElementById('answer-buttons');
        const nextBtn = document.getElementById('next-btn');
        const progressTextEl = document.getElementById('progress-text');
        const resultArea = document.getElementById('result-area');
        const questionArea = document.getElementById('question-area');
        const scoreTextEl = document.getElementById('score-text');
        const restartBtn = document.getElementById('restart-btn');

        // --- State Variables ---
        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = [];

        // --- Functions ---
        function shuffleArray(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            shuffledQuestions = shuffleArray([...quizData]); // Shuffle questions at the start
            progressTextEl.innerText = `سوال ۱ از ${shuffledQuestions.length}`;
            nextBtn.innerHTML = "سوال بعدی";
            nextBtn.disabled = true;
            questionArea.classList.remove('hidden');
            resultArea.classList.add('hidden');
            showQuestion();
        }

        function showQuestion() {
            resetState();
            let currentQuestion = shuffledQuestions[currentQuestionIndex];
            let questionNo = currentQuestionIndex + 1;
            
            questionTextEl.innerText = currentQuestion.question;
            progressTextEl.innerText = `سوال ${questionNo} از ${shuffledQuestions.length}`;

            // Shuffle answers for each question
            let shuffledAnswers = shuffleArray([...currentQuestion.answers]);

            shuffledAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.innerText = answer.text;
                button.classList.add('w-full', 'p-3', 'text-right', 'border-2', 'rounded-lg', 'transition-colors', 'duration-200', 'answer-btn', 'hover:bg-gray-100');
                answerButtonsEl.appendChild(button);
                if (answer.correct) {
                    button.dataset.correct = "true";
                }
                button.addEventListener('click', selectAnswer);
            });
        }
        
        function resetState() {
            nextBtn.disabled = true;
            while(answerButtonsEl.firstChild) {
                answerButtonsEl.removeChild(answerButtonsEl.firstChild);
            }
        }

        function selectAnswer(e) {
            const selectedBtn = e.target;
            const isCorrect = selectedBtn.dataset.correct === "true";
            
            if (isCorrect) {
                score++;
            } 
            
            // Show the correct answer and mark the user's choice
            Array.from(answerButtonsEl.children).forEach(button => {
                if(button.dataset.correct === "true") {
                    button.classList.add('correct');
                }
                if(button === selectedBtn && !isCorrect) {
                    button.classList.add('incorrect');
                }
                button.disabled = true;
            });

            nextBtn.disabled = false;
        }

        function showScore() {
            resetState();
            questionArea.classList.add('hidden');
            resultArea.classList.remove('hidden');
            progressTextEl.innerText = "آزمون تمام شد!";
            
            const scorePercent = Math.round((score / shuffledQuestions.length) * 100);
            scoreTextEl.innerHTML = `شما به ${score} سوال از ${shuffledQuestions.length} پاسخ صحیح دادید. <br> امتیاز شما: ${scorePercent}%`;
        }
        
        function handleNextButton() {
            currentQuestionIndex++;
            if (currentQuestionIndex < shuffledQuestions.length) {
                showQuestion();
            } else {
                showScore();
            }
        }

        // --- Event Listeners ---
        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < shuffledQuestions.length) {
                handleNextButton();
            }
        });

        restartBtn.addEventListener('click', startQuiz);

        // --- Initial Start ---
        startQuiz();
    </script>
</body>
</html>
